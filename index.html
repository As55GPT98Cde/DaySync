<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>DaySync</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3367D6">
  <style>
    :root {
      --accent: #3367D6;
      --bg: #fff;
      --text: #333;
      --field-bg: #fafafa;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --accent: #4A90E2;
        --bg: #111;
        --text: #eee;
        --field-bg: #222;
      }
    }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    .header {
      background: var(--accent);
      color: #fff;
      padding: 1rem;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .header h1 { margin: 0; font-size: 1.5rem; }
    .header p { margin: 0.2rem 0 0.5rem; font-size: 0.9rem; color: rgba(255,255,255,0.8); }
    .progress-bar {
      height: 4px;
      background: rgba(255,255,255,0.3);
      width: 100%;
    }
    .progress {
      height: 100%;
      width: 0%;
      background: #fff;
      transition: width 0.3s ease;
    }
    .container { padding: 0 1rem 6rem; }
    .field {
      display: flex;
      align-items: center;
      background: var(--field-bg);
      border-left: 4px solid var(--accent);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 0.75rem;
      margin: 0.5rem 0;
      border-radius: 8px;
    }
    .field.past { opacity: 0.6; }
    .field.current {
      background: var(--accent);
      color: #fff;
    }
    .field.current input,
    .field.current .duration { color: #fff; }
    .icon { margin-right: 0.5rem; }
    label { flex: 2; font-weight: 600; display: flex; align-items: center; }
    .duration { flex: 1; text-align: center; font-weight: 600; color: rgba(0,0,0,0.6); }
    input[type=time] { flex: 1; text-align: right; font-size: 1rem; background: none; border: none; color: inherit; }
    details summary {
      font-weight: 600;
      cursor: pointer;
      margin: 0.5rem 0;
      list-style: none;
    }
    details summary::-webkit-details-marker { display: none; }
    .buttons { flex: 1; display: flex; justify-content: flex-end; gap: 0.3rem; }
    .btn {
      background: none;
      border: none;
      font-size: 1.2rem;
      padding: 0.3rem;
      border-radius: 4px;
      color: inherit;
    }
    .btn:hover { background: rgba(0,0,0,0.1); cursor: pointer; }
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--field-bg);
      padding: 1.5rem 1rem;
      box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
      font-size: 1.2rem;
      text-align: center;
    }
    footer span { font-weight: 600; color: var(--accent); }
  </style>
</head>
<body>
  <div class="header">
    <h1>DaySync</h1>
    <p>Tap times, Reset ðŸ”„ or Now ðŸ•’ to recalc your day</p>
    <div class="progress-bar"><div class="progress"></div></div>
  </div>
  <div class="container" id="fields"></div>
  <footer id="summary"></footer>

  <script>
    const iconsMap = {
      'Wake Up':'â°','Morning Walk':'ðŸš¶','Decompression':'ðŸ§˜â€â™‚ï¸','Corrective':'ðŸ’ª',
      'Workout':'ðŸƒ','Smoothie & Shower':'ðŸš¿','Leave for Coffee':'â˜•',
      'Work Block 1':'ðŸ’¼','Work Block 2':'ðŸ’¼','Work Block 3':'ðŸ’¼','Work Block 4':'ðŸ’¼',
      'Personal Start':'ðŸ','Leave for Dinner':'ðŸš—','Dinner':'ðŸ½ï¸','Evening Walk':'ðŸš¶â€â™‚ï¸',
      'Free Time':'ðŸŽ‰','Shower':'ðŸš¿','Meditation':'ðŸ§˜','In Bed':'ðŸ›ï¸','Sleep By':'ðŸŒ™'
    };
    const events = [
      { name: 'Wake Up', duration:30, buffer:0 },
      { name: 'Morning Walk', duration:30, buffer:0 },
      { name: 'Decompression', duration:20, buffer:10 },
      { name: 'Corrective', duration:10, buffer:0 },
      { name: 'Workout', duration:30, buffer:5 },
      { name: 'Smoothie & Shower', duration:30, buffer:5 },
      { name: 'Leave for Coffee', duration:25, buffer:10 },
      { name: 'Work Block 1', duration:60, buffer:5 },
      { name: 'Work Block 2', duration:60, buffer:5 },
      { name: 'Work Block 3', duration:60, buffer:5 },
      { name: 'Work Block 4', duration:60, buffer:5 },
      { name: 'Personal Start', duration:60, buffer:5 },
      { name: 'Leave for Dinner', duration:30, buffer:20 },
      { name: 'Dinner', duration:60, buffer:0 },
      { name: 'Evening Walk', duration:30, buffer:0 },
      { name: 'Free Time', duration:150, buffer:0 },
      { name: 'Shower', duration:30, buffer:0 },
      { name: 'Meditation', duration:30, buffer:0 },
      { name: 'In Bed', duration:30, buffer:0 },
      { name: 'Sleep By', duration:0, buffer:0 }
    ];

    const container = document.getElementById('fields');
    const summaryEl = document.getElementById('summary');
    const progressEl = document.querySelector('.progress');
    let times = [], defaultTimes = [];

    function minutesToHHMM(m) {
      m = (m + 24*60) % (24*60);
      const hh = String(Math.floor(m/60)).padStart(2,'0');
      const mm = String(m%60).padStart(2,'0');
      return `${hh}:${mm}`;
    }
    function formatTime12(m) {
      m = (m + 24*60) % (24*60);
      let hh = Math.floor(m/60), mm = m%60;
      const ampm = hh >= 12 ? 'PM' : 'AM';
      hh = hh % 12 || 12;
      return `${hh}:${String(mm).padStart(2,'0')} ${ampm}`;
    }
    function formatDuration(mins) {
      if (mins < 60) return mins + 'm';
      const h = Math.floor(mins/60), m = mins % 60;
      return m ? `${h}h ${m}m` : `${h}h`;
    }
    function recalc(startIdx=0) {
      for (let i = startIdx + 1; i < events.length; i++) {
        const prev = events[i-1];
        times[i] = times[i-1] + prev.duration + events[i].buffer;
        inputs[i].value = minutesToHHMM(times[i]);
      }
      updateShading();
      updateSummary();
      updateProgress();
    }
    function updateShading() {
      const nowMin = new Date().getHours()*60 + new Date().getMinutes();
      inputs.forEach((input, i) => {
        const field = input.closest('.field');
        const start = times[i], end = start + events[i].duration;
        field.classList.remove('past','current','future');
        if (nowMin >= end) field.classList.add('past');
        else if (nowMin >= start && nowMin < end) field.classList.add('current');
        else field.classList.add('future');
      });
    }
    function updateSummary() {
      const nowMin = new Date().getHours()*60 + new Date().getMinutes();
      const idx = events.findIndex((_,i) => times[i] > nowMin);
      if (idx === -1 || idx >= events.length) {
        summaryEl.textContent = 'All tasks complete';
      } else {
        summaryEl.innerHTML = `Next: <span>${events[idx].name}</span> at <span>${formatTime12(times[idx])}</span>`;
      }
    }
    function updateProgress() {
      const nowMin = new Date().getHours()*60 + new Date().getMinutes();
      const total = times[times.length-1] - times[0];
      const elapsed = Math.min(Math.max(nowMin - times[0], 0), total);
      const pct = (elapsed/total)*100;
      progressEl.style.width = pct + '%';
    }

    const inputs = [];
    let inGroup = false, detailsEl;
    for (let i = 0; i < events.length; i++) {
      if (i === 7) {
        detailsEl = document.createElement('details');
        detailsEl.open = true;
        detailsEl.innerHTML = '<summary>Work Sessions</summary>';
        container.appendChild(detailsEl);
        inGroup = true;
      }
      const parent = inGroup ? detailsEl : container;
      const evt = events[i];
      const field = document.createElement('div'); field.className = 'field';
      const label = document.createElement('label');
      label.innerHTML = `<span class="icon">${iconsMap[evt.name] || ''}</span>${evt.name}`;
      const dur = document.createElement('div'); dur.className = 'duration'; dur.textContent = formatDuration(evt.duration);
      const input = document.createElement('input'); input.type = 'time'; input.step = 60;
      const buttons = document.createElement('div'); buttons.className = 'buttons';
      const resetBtn = document.createElement('button'); resetBtn.className = 'btn'; resetBtn.textContent = 'ðŸ”„';
      const nowBtn = document.createElement('button'); nowBtn.className = 'btn'; nowBtn.textContent = 'ðŸ•’';
      buttons.append(resetBtn, nowBtn);
      field.append(label, dur, input, buttons);
      parent.appendChild(field);
      inputs.push(input);

      input.addEventListener('change', () => {
        const [h,m] = input.value.split(':').map(Number);
        times[i] = h*60 + m;
        recalc(i);
      });
      resetBtn.addEventListener('click', () => {
        times[i] = defaultTimes[i];
        inputs[i].value = minutesToHHMM(times[i]);
        recalc(i);
      });
      nowBtn.addEventListener('click', () => {
        const now = new Date(); const mins = now.getHours()*60 + now.getMinutes();
        times[i] = mins; input.value = minutesToHHMM(mins); recalc(i);
      });

      if (i === 10) inGroup = false;
    }

    // Initialize defaults
    times[0] = 7*60; inputs[0].value = minutesToHHMM(times[0]);
    times[1] = times[0] + events[0].duration + events[1].buffer;
    inputs[1].value = minutesToHHMM(times[1]);
    recalc(1);
    defaultTimes = [...times];
    setInterval(() => { updateShading(); updateSummary(); updateProgress(); }, 60000);
  </script>
</body>
</html>
